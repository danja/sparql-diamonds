<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Bookmark List</title>

    <script src="lib/jquery-3.6.0.min.js"></script>

    <!-- mustache template compiler -->
    <script src="lib/hogan-3.0.2.js"></script>

    <!-- time format utils -->
    <script src="lib/moment.js"></script>




    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/sparql-connector.js"></script>

    <script src="sparql-templates/bookmarks-common.js"></script>
    <script src="sparql-templates/list-bookmarks.js"></script>

    <script type="text/javascript" language="javascript">
      // var getPageListSparql = sparqlTemplater(getPageListSparqlTemplate, {
      //     "graphURI": FooWiki.graphURI
      // });

      var linkTemplate = "~{#title}~ \
<a href='page-static.html?uri=~{uri}~'>~{title}~</a> \
~{/title}~ \
~{^title}~ \
<a href='page-static.html?uri=~{uri}~'>~{uri}~</a> \
  ~{/title}~ ";

      function formatRow(entry) { // content,
  //  entry.uri = "page.html?uri=" + entry.uri;
  entry.modified = moment(entry.modified).format("dddd, MMMM Do YYYY, h:mm:ss a");
  var row = templater(rowTemplate, entry);
  return row;
}

      var rowTemplate = " <tr> \
           <td>" + linkTemplate + "</td> \
           <td class='center'>~{modified}~</td> \
            <td class='center'>~{nick}~</td> \
            </tr>";

      function makeEntryListHTML (entryArray) {
        var rows = ''
        //  var entryArray = sparqlXMLtoJSON(xml);

        for (var i = 0; i < entryArray.length; i++) {
          rows += formatRow(entryArray[i])
        }
        return rows
      }

      var queryUrl =
        SparqlServer.host +
        SparqlServer.queryPath +
        '?query=' +
        encodeURIComponent(listBookmarksSparqlTemplate) +
        '&output=xml'

      $(function () {
        // setupErrorHandling();
        // spinner();

        // $("#graphName").attr("value", FooWiki.graphURI);
        // setupButtons();

        var doneCallback = function (json) {
          console.log('RESULT = ' +  JSON.stringify(json));
          var rows = makeEntryListHTML(json)
          $('#entries').replaceWith(rows)
  //        setupTagsPanel('#tagsPanelTagsContainer')
        }

        // does ajax and conversts results xml-json
        getJsonForSparqlURL(queryUrl, doneCallback)
        //      getDataForURL(doneCallback, getPagesUrl);
      })
    </script>
  </head>

  <body>
    Bookmarks
    <table>
      <tr>
        <th class="center">Page</th>
        <th class="center">Date</th>
        <th class="center">Creator</th>
      </tr>
      <tr id="bookmarks"></tr>
      <tr id="entries"></tr>
    </table>
  </body>
</html>
