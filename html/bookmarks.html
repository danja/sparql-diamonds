<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Bookmarks</title>

    <script src="../lib/jquery-3.6.0.min.js"></script>

    <!-- template engine -->
    <script src="../lib/hogan-3.0.2.js"></script>

    <!-- time format utils -->
    <script src="../lib/moment.js"></script>

    <script src="../js/config.js"></script>

    <script src="../js/utils.js"></script>
    <script src="../js/sparql-connector.js"></script>

    <script src="../sparql-templates/bookmarks-common.js"></script>
    <script src="../sparql-templates/bookmarks-by-title.js"></script>

    <script type="text/javascript" language="javascript">
      function makeList (linkArray) {
        var list = '<ul>'

        for (var i = 0; i < linkArray.length; i++) {
          console.log('linkArray[i] = ' + linkArray[i])
          list += templater(bookmarksSparqlTemplate, linkArray[i])
        }

        return list + '</ul>'
      }

      //   var resultsHandler = function (json) {
      function resultsHandler (json) {
        console.log('RESULT = ' + JSON.stringify(json))
//        console.log('RESULTS = ' + JSON.stringify(json['results']['bindings']))
        var bindings = json['results']['bindings']
        var bookmarks = []
        for (var i = 0; i < bindings.length; i++) {
          console.log('BINDING')
          console.log(JSON.stringify(bindings[i]))
           bookmarks.push({ link: bindings[i]['bookmark'] })
        }
        console.log('bookmarks = ' + JSON.stringify(bookmarks))
        // var list = makeList(json)
        var list = makeList(bookmarks)
        console.log('list = ' + list)
        $('#bookmarks').replaceWith(list)
      }

      /*
      function doQuery (name) {
        var dict = { name: name }
        console.log('dict = ' + JSON.stringify(dict))
        var wikidataNameSparql = templater(wikidataNameTemplate, dict)

        console.log('wikidataNameSparql = ' + wikidataNameSparql)

        var queryUrl =
          host + encodeURIComponent(wikidataNameSparql) + '&output=json'
        getResults(queryUrl, resultsHandler)
      }
      */

      function listByTitle () {
        // template on ORDER?

        // templater(wikidataNameTemplate, dict)

        var url =
          SparqlServer.host +
          SparqlServer.queryPath +
          "?query=" +
          encodeURIComponent(listBookmarksSparqlTemplate) +
          '&output=json';

        getResults(url, resultsHandler)
      }

      $(document).ready(function () {
        // $('#submit-button').click(function () {
        // console.log($('#wikidata-name').val())
        //  doQuery($('#wikidata-name').val())
        //})
        listByTitle();
      })
    </script>
  </head>

  <body>
    <h2>Bookmarks</h2>

    <p id="bookmarks"></p>
  </body>
</html>
