<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Wikidata things named 'Knot'</title>

    <script src="../lib/jquery-3.6.0.min.js"></script>

    <!-- template engine -->
    <script src="../lib/hogan-3.0.2.js"></script>

    <script src="../js/utils.js"></script>
    <script src="../js/sparql-connector.js"></script>

    <script type="text/javascript" language="javascript">
      var wikidataNameTemplate =
        '\n\
         PREFIX schema: <http://schema.org/>  \n\
         \n\
         SELECT DISTINCT ?target WHERE { \n\
         \n\
         ?target schema:name "~{name}~"@en . \n\
      }'

      var linkTemplate = "<li><a href='~{target}~'>~{target}~</a></li>"

      var endpoint = 'https://query.wikidata.org/sparql?query='



      function makeList (linkArray) {
        var list = '<ul>'

        for (var i = 0; i < linkArray.length; i++) {
          console.log("linkArray[i] = "+linkArray[i]);
          list += templater(linkTemplate, linkArray[i])
        }

        return list + '</ul>'
      }

      //   var resultsHandler = function (json) {
      function resultsHandler (json) {
        console.log('RESULT = ' + JSON.stringify(json))

        var list = makeList(json)

        console.log('list = ' + list)
        $('#targets').replaceWith(list)
      }

      function doQuery (name) {
      //  var map = "{ name: '"+name+"' }";
      //var dict = {};
      //dict["name"] = name;
      var dict = {name: name};
        console.log("dict = "+JSON.stringify(dict));
        var wikidataNameSparql = templater(wikidataNameTemplate, dict);

        console.log("wikidataNameSparql = "+wikidataNameSparql);

        var queryUrl =
          endpoint + encodeURIComponent(wikidataNameSparql) + '&output=xml'

        // does ajax and passes results json to handler
        getJsonForSparqlURL(queryUrl, resultsHandler);
      }

      $(document).ready(function () {
        $('#submit-button').click(function () {
          console.log($('#wikidata-name').val())
          doQuery($('#wikidata-name').val())
        })
      })
    </script>
  </head>

  <body>
    <h2>Wikidata named things</h2>

    <form id="name-form">
      <label>Name:</label>
      <input type="text" id="wikidata-name" />
      <button type="button" id="submit-button">Submit</button>
    </form>

    <p id="targets"></p>
  </body>
</html>
